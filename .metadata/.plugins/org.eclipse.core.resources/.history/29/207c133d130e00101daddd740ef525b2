package stepdef1;

import static org.testng.Assert.assertEquals;

import java.util.HashMap;

import org.openqa.selenium.By;

import com.google.common.collect.Multiset.Entry;

import io.cucumber.java.en.When;
import utilities.common_methods;

public class Add_to_cart extends common_methods{
	public static HashMap<String,Object[]> hm = new HashMap<>();
	public static String product;

//	@When("User choose \"(.*)")
//	public void click_category() {
//		
//	}
//	@When("User Click on \"(.*)")
//	public void user_click_on_product(String name) {	
//	}
//	
	@When("User choose {string}")
	public void user_choose(String category) {
		dr.findElement(By.xpath("//div[@class='block block-category-navigation']/div[2]//a[@href='/books']")).click();
	}
	
	@When("User Click on {string}")
	public void user_click_on(String name) {
		
//		dr.findElement(By.xpath("//div[@class='product-grid']//div[@class='picture']//a[@href='/computing-and-internet']")).click();
		dr.findElement(By.linkText(name)).click();
	}
	
	@When("User Click Add to cart")
	public void user_click_add_to_cart() {
		String product = dr.findElement(By.xpath("//div[@class='product-name']/h1")).getText();
		String price = dr.findElement(By.xpath("//div[@class='product-price']/span")).getText();
		Double p = Double.parseDouble(price);
		dr.findElement(By.className("qty-input")).clear();
		dr.findElement(By.className("qty-input")).sendKeys("2");
		String qty = dr.findElement(By.className("qty-input")).getDomAttribute("value");
		Integer q = Integer.parseInt(qty);
		dr.findElement(By.xpath("//div[@class='add-to-cart-panel']//input[2]")).click();
	    dr.findElement(By.xpath("//div[@class='block block-category-navigation']/div[2]//a[@href='/books']")).click();
	    hm.put(product, new Object[] {p,q});
	}
	
	@When("User Click on Shopping cart")
	public void user_click_on_shopping_cart() {
	    
		dr.findElement(By.xpath("//li[@id='topcartlink']//span[@class='cart-label']")).click();
		//table[@class='cart']//tr[@class='cart-item-row'][1]/td[5]/input
		System.out.println("hello");
		for(java.util.Map.Entry<String,Object[]> e:hm.entrySet()) {
			
			
			String name = dr.findElement(By.xpath("//table[@class='cart']//tr[@class='cart-item-row'][1]/td[3]/a")).getText();
			String xqty = dr.findElement(By.xpath("//table[@class='cart']//t[@class='cart-item-row'][1]/td[5]/input")).getDomAttribute("value");
			Integer i = Integer.parseInt(xqty);
			String Total = dr.findElement(By.xpath("//table[@class='cart']//tr[@class='cart-item-row'][1]/td[6]/span[2]")).getText();
			Double total = Double.parseDouble(Total);
			String a = e.getKey();
			System.out.println(a);
			Object obj[] = e.getValue();
			Double price = (Double) obj[0];
			int qty = (int) obj[1];
			Double tt = qty*price;
			assertEquals(total,tt);
			
			
			
		}
		
	}
	
	@When("User click checkout")
	public void user_click_checkout() {
	    
	    String s = dr.findElement(By.xpath("//td[@class='product']/a")).getText();
	    assertEquals(s,product);
		String b = dr.findElement(By.className("qty-input")).getDomAttribute("value");
  
	}
	
	
	
	
}
